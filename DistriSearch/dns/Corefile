# CoreDNS Configuration for DistriSearch Cluster
# Proporciona resolución DNS con failover automático

# Zona principal del cluster
distrisearch.local:53 {
    # Log de queries (útil para debugging)
    log
    
    # Errores a stdout
    errors
    
    # Health endpoint para verificar estado
    health :8080
    
    # Ready endpoint
    ready :8181
    
    # Resolución de nombres del cluster
    hosts /etc/coredns/hosts {
        # Los hosts se actualizan dinámicamente
        # Formato: IP nombre_host
        # Ejemplo:
        # 172.20.0.10 node_1.distrisearch.local
        # 172.20.0.11 node_2.distrisearch.local
        # 172.20.0.12 node_3.distrisearch.local
        
        # Alias principal - apunta a todos los nodos activos
        # Permite round-robin DNS nativo
        # 172.20.0.10 distrisearch.local
        # 172.20.0.11 distrisearch.local
        # 172.20.0.12 distrisearch.local
        
        fallthrough
        reload 5s  # Recargar archivo cada 5 segundos
    }
    
    # Caché de respuestas
    cache 30
    
    # Forward queries no resueltas al DNS de Docker
    forward . /etc/resolv.conf
}

# Zona de métricas (opcional)
.:9153 {
    prometheus
}
