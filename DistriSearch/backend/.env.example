# =============================================================================
# DistriSearch Backend - Configuración de Variables de Entorno
# =============================================================================
# Copia este archivo como .env y ajusta los valores según tu entorno

# -----------------------------------------------------------------------------
# CONFIGURACIÓN DE RED Y ACCESO EXTERNO
# -----------------------------------------------------------------------------

# URL pública del backend (para acceso desde otras máquinas)
# Cuando ejecutas en red local, usa la IP de tu máquina
# Ejemplo: PUBLIC_URL=https://192.168.1.100:8000
# Si usas localhost solo tú podrás acceder
PUBLIC_URL=http://localhost:8000

# IP externa/pública de esta máquina (para detección automática)
# El sistema intentará detectarla automáticamente si no se especifica
# Ejemplo: EXTERNAL_IP=192.168.1.100
EXTERNAL_IP=

# -----------------------------------------------------------------------------
# CONFIGURACIÓN SSL/TLS (HTTPS)
# -----------------------------------------------------------------------------

# Habilitar SSL/TLS (HTTPS)
# true = Usa HTTPS, false = Usa HTTP
ENABLE_SSL=false

# Rutas a los certificados SSL
# Genera los certificados con: powershell .\scripts\generate_ssl_certs.ps1
SSL_CERT_FILE=../certs/distrisearch.crt
SSL_KEY_FILE=../certs/distrisearch.key

# -----------------------------------------------------------------------------
# CONFIGURACIÓN DEL SERVIDOR
# -----------------------------------------------------------------------------

# Host del backend (0.0.0.0 permite conexiones externas)
BACKEND_HOST=0.0.0.0

# Puerto del backend
BACKEND_PORT=8000

# Habilitar auto-reload en desarrollo (desactivar en producción)
RELOAD=false

# -----------------------------------------------------------------------------
# SEGURIDAD Y AUTENTICACIÓN
# -----------------------------------------------------------------------------

# API Key para endpoints administrativos (opcional)
# Si no se define, los endpoints admin no requieren autenticación (¡SOLO PARA DEV!)
ADMIN_API_KEY=test_key_robustness_2024

# -----------------------------------------------------------------------------
# MODO CENTRAL Y CARPETA COMPARTIDA
# -----------------------------------------------------------------------------

# Auto-escanear carpeta compartida al iniciar
CENTRAL_AUTO_SCAN=false

# Ruta a la carpeta compartida central
CENTRAL_SHARED_FOLDER=../central_shared

# -----------------------------------------------------------------------------
# MANTENIMIENTO Y REPLICACIÓN
# -----------------------------------------------------------------------------

# Intervalo de tareas de mantenimiento (en segundos)
# Verifica timeouts de nodos y ejecuta replicación
MAINTENANCE_INTERVAL_SECONDS=300

# -----------------------------------------------------------------------------
# CLUSTER (ARQUITECTURA MASTER-SLAVE)
# -----------------------------------------------------------------------------

# ID único del nodo en el cluster
NODE_ID=node_1

# Rol inicial del nodo: slave (por defecto), puede ser elegido master
NODE_ROLE=slave

# ¿Este nodo puede ser candidato a Master?
MASTER_CANDIDATE=true

# Lista de peers conocidos (IPs o hostnames separados por coma)
# Ejemplo: CLUSTER_PEERS=192.168.1.10:8000,192.168.1.11:8000
CLUSTER_PEERS=

# Intervalo de heartbeat (en segundos)
HEARTBEAT_INTERVAL=5

# Timeout para considerar un nodo caído (en segundos)
HEARTBEAT_TIMEOUT=15

# -----------------------------------------------------------------------------
# FRONTEND (para referencia)
# -----------------------------------------------------------------------------

# URL del backend desde el frontend
# Debe coincidir con PUBLIC_URL para acceso externo
DISTRISEARCH_BACKEND_URL=http://localhost:8000

# URL pública del backend (alternativa)
DISTRISEARCH_BACKEND_PUBLIC_URL=http://localhost:8000

# API Key para llamadas desde el frontend (si ADMIN_API_KEY está definida)
DISTRISEARCH_ADMIN_API_KEY=

# -----------------------------------------------------------------------------
# COORDINACIÓN DISTRIBUIDA
# -----------------------------------------------------------------------------

# Dificultad para la prueba de trabajo (proof of work)
POW_DIFFICULTY=4

# Intervalo para verificar el líder (en segundos)
LEADER_CHECK_INTERVAL=60

# Tiempo de espera para el mutex (en segundos)
MUTEX_TIMEOUT=30

# -----------------------------------------------------------------------------
# EJEMPLO DE CONFIGURACIÓN PARA RED LOCAL CON HTTPS
# -----------------------------------------------------------------------------

# Descomenta y ajusta estos valores para habilitar HTTPS en red local:
# PUBLIC_URL=https://192.168.1.100:8000
# EXTERNAL_IP=192.168.1.100
# ENABLE_SSL=true
# SSL_CERT_FILE=../certs/distrisearch.crt
# SSL_KEY_FILE=../certs/distrisearch.key
# DISTRISEARCH_BACKEND_URL=https://192.168.1.100:8000
# DISTRISEARCH_BACKEND_PUBLIC_URL=https://192.168.1.100:8000

# NOTAS IMPORTANTES:
# 1. Genera los certificados SSL con: powershell .\scripts\generate_ssl_certs.ps1
# 2. Los certificados autofirmados mostrarán advertencia en el navegador
# 3. Para producción, usa certificados de Let's Encrypt u otra CA válida
# 4. Asegúrate de que el firewall permita el tráfico en el puerto configurado

# ============ REPLICACIÓN ============
REPLICATION_ENABLED=true          # ✅ Debe estar en true
REPLICATION_FACTOR=3               # ✅ Debe ser >= 2
CONSISTENCY_MODEL=eventual
CONFLICT_RESOLUTION=last_write_wins
SYNC_INTERVAL_SECONDS=60

# ============ BACKEND ============
BACKEND_URL=http://10.2.0.2:8000
ADMIN_API_KEY=test_key_robustness_2024
MONGO_URI=mongodb://localhost:27017
MONGO_DBNAME=distrisearch